<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>我是一个模板</title>
    <script src="./js/vue.js"></script>
    <script src="./js/vue-router.js"></script>
    <link rel="stylesheet" href="./css/el/index.css">
    <script src="./js/el/index.js"></script>
    <script type='text/javascript' src='./js/axios/index.js'></script>
    <script type='text/javascript' src='./api/ajax.js'></script>
    <script  src="./api/EmpAPI.js"></script>
    <script  src="./api/DeptAPI.js"></script>
    <style>
        /*找到html标签、body标签，和挂载的标签 都给他们统一设置样式*/
        html, body, #app, .el-container {
            /*设置内部填充为0，几个布局元素之间没有间距*/
            padding: 0px;
            /*外部间距也是如此设置*/
            margin: 0px;
            /*统一设置高度为100%*/
            height: 100%;
        }
        /*添加按钮靠右显示*/
        .rightAlign {
            text-align: right;
        }
    </style>
</head>
<body>
<div id="app">
    <el-container>
        <el-aside>
            <el-menu router>
                <el-menu-item index="emp">员工管理</el-menu-item>
                <el-menu-item index="dept">部门管理</el-menu-item>
            </el-menu>
        </el-aside>
        <el-main>
            <router-view></router-view>
        </el-main>
    </el-container>

</div>
<template id="emp">
    <div>
        <el-table :data="emps">
            <el-table-column prop="empno" label="编号" width="100" align="center"></el-table-column>
            <el-table-column prop="ename" label="姓名" ></el-table-column>
            <el-table-column prop="job" label="岗位"></el-table-column>
            <el-table-column prop="mgr" label="领导编号" width="100"></el-table-column>
            <el-table-column prop="hiredate" label="入职日期" width="180"></el-table-column>
            <el-table-column prop="sal" label="薪资"></el-table-column>
            <el-table-column prop="comm" label="业绩"></el-table-column>
            <el-table-column prop="deptno" label="部门编号" width="100"></el-table-column>
        </el-table>
        <el-pagination
            @size-change="handleSizeChange" @current-change="handleCurrentChange"
            layout="total, sizes, prev, pager, next, jumper" :current-page="currentPage"
            :page-sizes="[3,5, 10, 15]" :page-size="3" :total="total">
        </el-pagination>
    </div>
</template>
<template id="dept">
    <div>
        <el-table :data="depts">
            <el-table-column prop="deptno" label="部门编号" width="100" align="center"></el-table-column>
            <el-table-column prop="dname" label="部门名称" ></el-table-column>
            <el-table-column prop="loc" label="所在地"></el-table-column>
        </el-table>
        <el-pagination
            @size-change="handleSizeChange" @current-change="handleCurrentChange"
            layout="total, sizes, prev, pager, next, jumper" :current-page="currentPage"
            :page-sizes="[3,5, 10, 15]" :page-size="3" :total="total">
        </el-pagination>
    </div>
</template>
<script>
    let emp = {
        template:'#emp',
        data:function (){
            return {
                emps:[],
                emp: { // 新增(新增前需要清空emp),编辑(需要将当前行赋值给emp),查询(与查询条件双向绑定)共用
                    empno: undefined,
                    ename: '',
                    job: '',
                    mgr: undefined,
                    hiredate: undefined,
                    sal: undefined,
                    comm: undefined,
                    deptno: undefined,
                },
                total: 0,
                currentPage:1,
                pageSize:5,
                sortInfo:'empno asc'
            }
        },
        methods:{
            // pageSize变动,触发重新从后台加载数据
            handleSizeChange(pageSize) {
                this.pageSize = pageSize
                this.getEmps()
            },
            // currentPage变动,触发从后台加载数据
            handleCurrentChange(currentPage) {
                this.currentPage = currentPage
                this.getEmps()
            },
            async getEmps() {
                let url = 'getEmpsBypage'
                let {emp,currentPage,pageSize,sortInfo} = this
                // 组装分页与排序
                emp.currentPage=currentPage
                emp.pageSize=pageSize
                emp.sortInfo=sortInfo
                let empPageInfo = await getEmpsBypage(url,emp,'POST')
                this.emps = empPageInfo.list
                this.total = empPageInfo.total
            },
        },
        mounted(){
            this.getEmps()
        }
    }
    let dept = {
        template:'#dept',
        data:function (){
            return {
                depts:[],
                dept: { // 新增(新增前需要清空emp),编辑(需要将当前行赋值给emp),查询(与查询条件双向绑定)共用
                    deptno: undefined,
                    dname: '',
                    loc: ''
                },
                total: 0,
                currentPage:1,
                pageSize:3,
                sortInfo:'deptno asc'
            }
        },
        methods:{
            // pageSize变动,触发重新从后台加载数据
            handleSizeChange(pageSize) {
                this.pageSize = pageSize
                this.getDepts()
            },
            // currentPage变动,触发从后台加载数据
            handleCurrentChange(currentPage) {
                this.currentPage = currentPage
                this.getDepts()
            },
            async getDepts() {
                let url = 'getDeptsBypage'
                let {dept,currentPage,pageSize,sortInfo} = this
                // 组装分页与排序
                dept.currentPage=currentPage
                dept.pageSize=pageSize
                dept.sortInfo=sortInfo
                let deptPageInfo = await getDeptsBypage(url,dept,'POST')
                this.depts = deptPageInfo.list
                this.total = deptPageInfo.total
            },
        },
        mounted(){
            this.getDepts()
        }
    }
    let routes = [
        //每个路由对应一个组件
        {path: '/emp', component: emp},
        {path: '/dept', component: dept}
    ]
    let router = new VueRouter({
        routes
    })
    new Vue({
        el: '#app',
        router
    })
</script>

</body>
</html>